name: YouTube Downloader

on:
  workflow_dispatch:
    inputs:
      playlist_url:
        description: 'YouTube Playlist URL'
        required: true

jobs:
  download:
    runs-on: ubuntu-latest
    
    steps:
    - name: Installer les outils
      run: |
        sudo apt update
        sudo apt install -y python3-pip ffmpeg zip
        pip3 install yt-dlp

    - name: Créer le fichier cookies
      run: |
        cat > cookies.txt << 'EOF'
# Netscape HTTP Cookie File
.youtube.com	TRUE	/	FALSE	1796420629	HSID	A8XM_f52BFLyhr5B3
.youtube.com	TRUE	/	TRUE	1796420629	SSID	AqP1D6G4pLc7f88Bt
.youtube.com	TRUE	/	FALSE	1796420629	APISID	e-IqRTByZ4RaIq-Q/ApaJSIuJ5Wne8d0TZ
.youtube.com	TRUE	/	TRUE	1796420629	SAPISID	mgaOzZZe281Ea6_q/AYvkZ-qF22xw-35-t
.youtube.com	TRUE	/	TRUE	1796420629	__Secure-1PAPISID	mgaOzZZe281Ea6_q/AYvkZ-qF22xw-35-t
.youtube.com	TRUE	/	TRUE	1796420629	__Secure-3PAPISID	mgaOzZZe281Ea6_q/AYvkZ-qF22xw-35-t
.youtube.com	TRUE	/	TRUE	1795547058	LOGIN_INFO	AFmmF2swRAIgCsYq6oKITKKUbgf5KlRCVY0XXC9Hk1BCkuP0zkWNK3MCIG-aI53OvSx5Yzu3leemSEebTXKBedWxtgdIHnGNS4LC:QUQ3MjNmeEpPc0VycUVuNDM3bVdqcmhROU9CcnRvU3lyYnNrXzFUVy0zYTU4eXl0MFZXcnVwbmdwVUl5RUJlemtudEcwUjBoNWVYWldwenBXM2lXUHlfX3NheEVXOU9hVkFUYkh1WG9nRzdjQWg1aUFvcEJxYVdwcXRsb2xocVhnNWo4TWJGdHIxdWNBVTh2dzU0UmhNTEVvcjM5TnZfNkFB
.youtube.com	TRUE	/	TRUE	1796421663	PREF	f4=4000000&tz=Africa.Casablanca&f7=100
EOF

    - name: Télécharger les vidéos
      run: |
        yt-dlp \
          --cookies cookies.txt \
          --format "best[ext=mp4]" \
          --ignore-errors \
          --no-warnings \
          -o "videos/%(title)s.%(ext)s" \
          "${{ github.event.inputs.playlist_url }}"

    - name: Créer le ZIP
      run: |
        zip -r youtube_videos.zip videos/

    - name: Upload le résultat
      uses: actions/upload-artifact@v4
      with:
        name: youtube-downloads
        path: youtube_videos.zip
