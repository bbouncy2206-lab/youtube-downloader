name: YouTube Turbo (Sans Cookies)
on:
  workflow_dispatch:
    inputs:
      playlist_url:
        description: 'URL playlist YouTube'
        required: true

jobs:
  download:
    runs-on: ubuntu-latest
    timeout-minutes: 30
    
    steps:
    - name: Installer yt-dlp avec dépendances
      run: |
        sudo apt-get update
        sudo apt-get install -y ffmpeg python3-pip aria2
        pip3 install yt-dlp --upgrade
        
    - name: Téléchargement turbo sans cookies
      run: |
        yt-dlp \
        --format "best[ext=mp4]/best" \
        --ignore-errors \
        --no-warnings \
        --restrict-filenames \
        --concurrent-fragments 5 \
        --throttled-rate 1M \
        --buffer-size 16K \
        --http-chunk-size 10M \
        --extractor-args "youtube:player_client=android" \
        --add-header "User-Agent:Mozilla/5.0 (Linux; Android 10) AppleWebKit/537.36" \
        --add-header "Accept-Language:fr-FR,fr;q=0.9" \
        -o "videos/%(title).100s.%(ext)s" \
        "${{ inputs.playlist_url }}"
        
    - name: Upload résultat
      uses: actions/upload-artifact@v4
      with:
        name: youtube-turbo
        path: videos/
